<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: #282c34;
            color: #fff;
            font-family: 'Montserrat', Arial, sans-serif;
            margin: 0; padding: 0;
        }
        .centered {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .card {
            background: #23272f;
            border-radius: 20px;
            padding: 36px 36px 24px 36px;
            box-shadow: 0 8px 40px rgba(0,0,0,0.25);
            min-width: 340px;
            max-width: 400px;
            text-align: center;
        }
        .card img {
            width: 88px;
            margin-bottom: 14px;
        }
        .channels {
            text-align: left;
            margin: 18px 0 22px 0;
        }
        .channels .ok {
            color: #4caf50; font-weight: bold;
        }
        .channels .fail {
            color: #f44336; font-weight: bold;
        }
        .btn {
            background: #5a7cff;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 14px 0;
            width: 100%;
            font-size: 1.15rem;
            margin-top: 8px;
            cursor: pointer;
            transition: background .2s;
        }
        .btn:active { background: #3254e7; }
        .success {
            color: #7fff92;
            font-size: 1.1em;
            font-weight: 600;
            margin: 10px 0 12px 0;
        }
        .error {
            color: #ff8080;
            font-size: 1.05em;
            margin: 8px 0 10px 0;
        }
    </style>
</head>
<body>
<div class="centered">
    <div class="card" id="main-card">
        <img src="https://cdn-icons-png.flaticon.com/512/3990/3990379.png" alt="Dice">
        <div id="status-area">
            <div class="error" id="status-msg">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É...</div>
            <div class="channels" id="channels-list"></div>
        </div>
        <button class="btn" id="check-btn" style="display:none;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–Ω–æ–≤–∞</button>
        <button class="btn" id="close-btn" style="display:none;background:#6fb05a;">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp API
    let tg = window.Telegram.WebApp;
    tg.expand();

    // –ü–æ–ª—É—á–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ–∑—ã–≥—Ä—ã—à–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ URL)
    // –ü—Ä–∏–º–µ—Ä: https://skif1237.github.io/telegram-botapp/?giveaway_id=123
    function getQueryParam(name) {
        let url = new URL(window.location.href);
        return url.searchParams.get(name);
    }
    const giveaway_id = getQueryParam('giveaway_id');
    // user_id –∏–∑ Telegram API
    let user_id = tg.initDataUnsafe?.user?.id || null;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ backend
    async function checkSubscription() {
        document.getElementById("status-msg").innerText = "–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É...";
        document.getElementById("channels-list").innerHTML = "";
        document.getElementById("check-btn").style.display = "none";
        document.getElementById("close-btn").style.display = "none";

        // –°–¥–µ–ª–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ backend
        // URL backend-–∞ –ó–ê–ú–ï–ù–ò –Ω–∞ —Å–≤–æ–π!
        let backend_url = `https://your-backend.com/check_subscription`;
        let payload = {
            user_id: user_id,
            giveaway_id: giveaway_id,
            // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –µ—â–µ —á—Ç–æ-—Ç–æ –∏–∑ tg.initDataUnsafe
            // auth_data: tg.initData
        };

        try {
            let res = await fetch(backend_url, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            let data = await res.json();

            // –ü—Ä–∏–º–µ—Ä data: {ok: false, not_subscribed: [{title: "...", url: "..."}, ...], subscribed: [...]}
            if (data.ok) {
                document.getElementById("status-msg").innerHTML = "<span class='success'>üéâ –¢–µ–ø–µ—Ä—å –í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ!</span>";
                document.getElementById("channels-list").innerHTML = "";
                document.getElementById("close-btn").style.display = "";
            } else {
                document.getElementById("status-msg").innerHTML = "<span class='error'>‚ùó –í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã –Ω–∞ –≤—Å–µ –∫–∞–Ω–∞–ª—ã.</span>";
                let list = "";
                if (data.not_subscribed && data.not_subscribed.length) {
                    data.not_subscribed.forEach(ch =>
                        list += `<div class="fail">‚úñ <a href="${ch.url}" target="_blank" style="color:#f44336">${ch.title}</a></div>`
                    );
                }
                if (data.subscribed && data.subscribed.length) {
                    data.subscribed.forEach(ch =>
                        list += `<div class="ok">‚úî <a href="${ch.url}" target="_blank" style="color:#7fff92">${ch.title}</a></div>`
                    );
                }
                document.getElementById("channels-list").innerHTML = list;
                document.getElementById("check-btn").style.display = "";
            }
        } catch (e) {
            document.getElementById("status-msg").innerText = "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.";
            document.getElementById("check-btn").style.display = "";
        }
    }

    document.getElementById("check-btn").onclick = checkSubscription;
    document.getElementById("close-btn").onclick = () => { tg.close(); };

    window.onload = checkSubscription;
</script>
</body>
</html>
